<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#FF6B00">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="–†–æ–∑–º–æ–≤–Ω–∏–∫ NL">
    <title>–®–≤–∏–¥–∫–∏–π —Ä–æ–∑–º–æ–≤–Ω–∏–∫ NL üá∫üá¶üá≥üá±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#FF6B00',
                        cream: '#FFF9F0',
                    }
                }
            }
        }
    </script>
    <style>
        * { -webkit-tap-highlight-color: transparent; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body class="bg-cream min-h-screen pb-20">
    
    <!-- HOME TAB -->
    <div id="home-tab" class="tab-content active fade-in p-4 max-w-lg mx-auto">
        <div class="text-center mb-6 pt-4">
            <h1 class="text-2xl font-bold text-gray-800">–ü—Ä–∏–≤—ñ—Ç! üëã</h1>
            <p class="text-gray-600 mt-1">–©–æ –±—É–¥–µ–º–æ –≤—á–∏—Ç–∏ —Å—å–æ–≥–æ–¥–Ω—ñ?</p>
        </div>

        <div class="grid grid-cols-2 gap-4 mb-6">
            <button onclick="showTab('expressions')" class="text-left">
                <div class="bg-primary rounded-2xl p-5 text-white shadow-lg hover:shadow-xl transition-shadow">
                    <div class="text-3xl mb-2">üí¨</div>
                    <h2 class="text-lg font-bold">–ù—ñ–¥–µ—Ä–ª–∞–Ω–¥—Å—å–∫—ñ –í–∏—Ä–∞–∑–∏</h2>
                    <p class="text-sm opacity-90 mt-1">460+ —ñ–¥—ñ–æ–º ‚Üí</p>
                </div>
            </button>
            
            <button onclick="showTab('phrasebook')" class="text-left">
                <div class="bg-white border-2 border-primary rounded-2xl p-5 text-gray-800 shadow-lg hover:shadow-xl transition-shadow">
                    <div class="text-3xl mb-2">üìñ</div>
                    <h2 class="text-lg font-bold text-primary">–†–æ–∑–º–æ–≤–Ω–∏–∫</h2>
                    <p class="text-sm text-gray-600 mt-1">500+ —Ñ—Ä–∞–∑ ‚Üí</p>
                </div>
            </button>
        </div>

        <!-- Daily Expression -->
        <div class="bg-white rounded-2xl p-5 shadow-md mb-6">
            <div class="flex items-center gap-2 mb-3">
                <span class="bg-primary text-white text-xs font-semibold px-2 py-1 rounded-full">–í–ò–†–ê–ó –î–ù–Ø</span>
            </div>
            <div id="daily-expression">
                <div class="animate-pulse">
                    <div class="h-6 bg-gray-200 rounded w-3/4 mb-2"></div>
                    <div class="h-4 bg-gray-200 rounded w-1/2"></div>
                </div>
            </div>
        </div>

        <!-- Quick Categories -->
        <div>
            <h2 class="text-lg font-semibold text-gray-800 mb-3">üî• –ü–æ–ø—É–ª—è—Ä–Ω—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó</h2>
            <div class="grid grid-cols-3 gap-3">
                <button onclick="showPhrasebookCategory('–ú–µ–¥–∏—Ü–∏–Ω–∞')" class="bg-white rounded-xl p-3 text-center shadow-sm hover:shadow-md">
                    <div class="text-2xl mb-1">üè•</div>
                    <p class="text-xs text-gray-700">–ú–µ–¥–∏—Ü–∏–Ω–∞</p>
                </button>
                <button onclick="showPhrasebookCategory('–ú—ñ–≥—Ä–∞—Ü—ñ–π–Ω–∞ —Å–ª—É–∂–±–∞')" class="bg-white rounded-xl p-3 text-center shadow-sm hover:shadow-md">
                    <div class="text-2xl mb-1">üõÇ</div>
                    <p class="text-xs text-gray-700">IND</p>
                </button>
                <button onclick="showPhrasebookCategory('–ö—Ä–∏–∑–æ–≤–∞ –¥–æ–ø–æ–º–æ–≥–∞')" class="bg-white rounded-xl p-3 text-center shadow-sm hover:shadow-md">
                    <div class="text-2xl mb-1">üÜò</div>
                    <p class="text-xs text-gray-700">–ö—Ä–∏–∑–æ–≤–∞ –¥–æ–ø–æ–º–æ–≥–∞</p>
                </button>
            </div>
        </div>
    </div>

    <!-- EXPRESSIONS TAB -->
    <div id="expressions-tab" class="tab-content fade-in p-4 max-w-lg mx-auto">
        <div class="flex items-center gap-3 mb-4 pt-2">
            <button onclick="showExpressionCategories()" id="expr-back-btn" class="p-2 -ml-2 text-primary hidden">
                ‚Üê 
            </button>
            <h1 class="text-xl font-bold text-gray-800" id="expr-title">–í–∏—Ä–∞–∑–∏</h1>
        </div>

        <div class="relative mb-4">
            <input type="text" id="expr-search" placeholder="üîç –ü–æ—à—É–∫..." oninput="filterExpressions()"
                class="w-full px-4 py-3 bg-white rounded-xl border border-gray-200 focus:outline-none focus:border-primary">
        </div>

        <div id="expressions-content">
            <!-- Categories or list will be loaded here -->
        </div>
    </div>

    <!-- PHRASEBOOK TAB -->
    <div id="phrasebook-tab" class="tab-content fade-in p-4 max-w-lg mx-auto">
        <div class="flex items-center gap-3 mb-4 pt-2">
            <button onclick="showPhrasebookCategories()" id="phrase-back-btn" class="p-2 -ml-2 text-primary hidden">
                ‚Üê
            </button>
            <h1 class="text-xl font-bold text-gray-800" id="phrase-title">–†–æ–∑–º–æ–≤–Ω–∏–∫</h1>
        </div>

        <div class="relative mb-4">
            <input type="text" id="phrase-search" placeholder="üîç –ü–æ—à—É–∫..." oninput="filterPhrases()"
                class="w-full px-4 py-3 bg-white rounded-xl border border-gray-200 focus:outline-none focus:border-primary">
        </div>

        <div id="phrasebook-content">
            <!-- Categories or list will be loaded here -->
        </div>
    </div>

    <!-- PROFILE TAB -->
    <div id="profile-tab" class="tab-content fade-in p-4 max-w-lg mx-auto">
        <h1 class="text-xl font-bold text-gray-800 pt-2 mb-6">–ü—Ä–æ—Ñ—ñ–ª—å</h1>

        <div class="bg-gray-900 rounded-2xl p-5 text-white mb-6">
            <div class="flex items-center gap-4">
                <div class="w-14 h-14 bg-primary rounded-full flex items-center justify-center text-xl font-bold">UA</div>
                <div>
                    <h2 class="font-semibold text-lg">–ì—ñ—Å—Ç—å</h2>
                    <p class="text-gray-400 text-sm">–ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∏–π –ø–ª–∞–Ω</p>
                </div>
            </div>
        </div>

        <div class="bg-gradient-to-r from-primary to-orange-400 rounded-2xl p-5 text-white mb-6">
            <h3 class="font-bold text-lg mb-1">üíé Premium</h3>
            <p class="text-sm opacity-90 mb-3">–î–æ—Å—Ç—É–ø –¥–æ –≤—Å—ñ—Ö 1000+ —Ñ—Ä–∞–∑</p>
            <p class="text-xs opacity-75">–°–∫–æ—Ä–æ!</p>
        </div>

        <div class="bg-white rounded-2xl overflow-hidden shadow-sm">
            <button onclick="shareApp()" class="w-full flex items-center gap-4 p-4 hover:bg-gray-50 border-b">
                <span class="text-2xl">üì§</span>
                <span class="text-gray-800">–ü–æ–¥—ñ–ª–∏—Ç–∏—Å—è –¥–æ–¥–∞—Ç–∫–æ–º</span>
            </button>
            <a href="https://empatia.nl" target="_blank" class="flex items-center gap-4 p-4 hover:bg-gray-50 border-b">
                <span class="text-2xl">üíô</span>
                <span class="text-gray-800">Empatia - –ø—ñ–¥—Ç—Ä–∏–º–∫–∞</span>
            </a>
            <a href="tel:112" class="flex items-center gap-4 p-4 hover:bg-gray-50">
                <span class="text-2xl">üÜò</span>
                <span class="text-gray-800">–ï–∫—Å—Ç—Ä–µ–Ω–∞ –¥–æ–ø–æ–º–æ–≥–∞: 112</span>
            </a>
        </div>

        <div class="text-center mt-8 text-gray-400 text-sm">
            <p>–®–≤–∏–¥–∫–∏–π —Ä–æ–∑–º–æ–≤–Ω–∏–∫ NL</p>
            <p class="mt-1">üíôüíõ –î–ª—è —É–∫—Ä–∞—ó–Ω—Ü—ñ–≤ —É –ù—ñ–¥–µ—Ä–ª–∞–Ω–¥–∞—Ö</p>
        </div>
    </div>

    <!-- BOTTOM NAVIGATION -->
    <nav class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 px-4 py-2 safe-area-pb">
        <div class="max-w-lg mx-auto flex justify-around items-center">
            <button onclick="showTab('home')" id="nav-home" class="flex flex-col items-center py-1 px-3 text-primary">
                <span class="text-xl">üè†</span>
                <span class="text-xs mt-1 font-semibold">–ì–æ–ª–æ–≤–Ω–∞</span>
            </button>
            <button onclick="showTab('expressions')" id="nav-expressions" class="flex flex-col items-center py-1 px-3 text-gray-500">
                <span class="text-xl">üí¨</span>
                <span class="text-xs mt-1">–í–∏—Ä–∞–∑–∏</span>
            </button>
            <button onclick="showTab('phrasebook')" id="nav-phrasebook" class="flex flex-col items-center py-1 px-3 text-gray-500">
                <span class="text-xl">üìñ</span>
                <span class="text-xs mt-1">–†–æ–∑–º–æ–≤–Ω–∏–∫</span>
            </button>
            <button onclick="showTab('profile')" id="nav-profile" class="flex flex-col items-center py-1 px-3 text-gray-500">
                <span class="text-xl">üë§</span>
                <span class="text-xs mt-1">–ü—Ä–æ—Ñ—ñ–ª—å</span>
            </button>
        </div>
    </nav>

    <script>
        // Supabase initialization
        const supabaseUrl = 'https://akvfcemyrkadonbaghsf.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFrdmZjZW15cmthZG9uYmFnaHNmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjcyNjU4MTQsImV4cCI6MjA4Mjg0MTgxNH0.rxBWHMl8X8m3-U1gbGG-gX9gjPvnqUzBqWDI0a9RGiI';
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

        // Data storage
        let allExpressions = [];
        let allPhrases = [];
        let currentExprCategory = null;
        let currentPhraseCategory = null;

        // Category emojis
        const categoryEmojis = {
            '–ì—Ä–æ—à—ñ —Ç–∞ —Ñ—ñ–Ω–∞–Ω—Å–∏': 'üí∞',
            '–†–æ–±–æ—Ç–∞ —Ç–∞ –∫–∞—Ä\'—î—Ä–∞': 'üíº',
            '–ü–æ–≥–æ–¥–∞': 'üå§Ô∏è',
            '–á–∂–∞ —Ç–∞ –Ω–∞–ø–æ—ó': 'üçΩÔ∏è',
            '–°—Ç–æ—Å—É–Ω–∫–∏': '‚ù§Ô∏è',
            '–ü–æ–±—É—Ç': 'üè†',
            '–ß–∞—Å': '‚è∞',
            '–ú–µ–¥–∏—Ü–∏–Ω–∞': 'üè•',
            '–ú—ñ–≥—Ä–∞—Ü—ñ–π–Ω–∞ —Å–ª—É–∂–±–∞': 'üõÇ',
            '–ö—Ä–∏–∑–æ–≤–∞ –¥–æ–ø–æ–º–æ–≥–∞': 'üÜò',
            '–ü–æ—Ö–æ—Ä–æ–Ω–∏': '‚ö∞Ô∏è',
            '–Ø –Ω–µ —Ä–æ–∑—É–º—ñ—é': 'ü§∑',
            '–†–æ–±–æ—Ç–∞': 'üíº',
            '–á–∂–∞': 'üçΩÔ∏è',
            '–û—Å–≤—ñ—Ç–∞': 'üéì',
            '–û–±—Ä–∞–∑–∏ —Ç–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ': 'üõ°Ô∏è',
            '–ß–∞—Å—Ç–∏–Ω–∏ —Ç—ñ–ª–∞': 'ü¶¥',
            '–•–≤–æ—Ä–æ–±–∏ —Ç–∞ —Å–∏–º–ø—Ç–æ–º–∏': 'ü§í',
            '–õ—ñ–∫–∞—Ä—ñ —Ç–∞ –º–µ–¥–∏—Ü–∏–Ω–∞': 'üë®‚Äç‚öïÔ∏è',
            '–õ–∞–π–∫–∞ —Ç–∞ —Å–ª–µ–Ω–≥': 'ü§¨',
        };

        // Tab navigation
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.getElementById(tabName + '-tab').classList.add('active');
            
            document.querySelectorAll('nav button').forEach(btn => {
                btn.classList.remove('text-primary');
                btn.classList.add('text-gray-500');
                btn.querySelector('span:last-child').classList.remove('font-semibold');
            });
            const activeBtn = document.getElementById('nav-' + tabName);
            activeBtn.classList.remove('text-gray-500');
            activeBtn.classList.add('text-primary');
            activeBtn.querySelector('span:last-child').classList.add('font-semibold');

            if (tabName === 'expressions' && allExpressions.length === 0) loadExpressions();
            if (tabName === 'phrasebook' && allPhrases.length === 0) loadPhrases();
        }

        // Load daily expression
        async function loadDailyExpression() {
            try {
                const { data, error } = await supabase
                    .from('expressions')
                    .select('*')
                    .limit(100);
                
                if (error) throw error;
                
                if (data && data.length > 0) {
                    const random = data[Math.floor(Math.random() * data.length)];
                    document.getElementById('daily-expression').innerHTML = `
                        <div class="flex items-start justify-between">
                            <div>
                                <h3 class="text-lg font-semibold text-gray-800">${random.dutch_expression}</h3>
                                <p class="text-gray-600 mt-1">${random.ukrainian_translation}</p>
                            </div>
                            <button onclick="speak('${random.dutch_expression.replace(/'/g, "\\'")}')" 
                                class="p-2 rounded-full bg-primary/10 text-primary hover:bg-primary/20">
                                üîä
                            </button>
                        </div>
                        <p class="text-sm text-gray-500 mt-3 pt-3 border-t border-gray-100">${random.category || ''}</p>
                    `;
                }
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('daily-expression').innerHTML = '<p class="text-gray-500">–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏</p>';
            }
        }

        // Load expressions
        async function loadExpressions() {
            try {
                const { data, error } = await supabase.from('expressions').select('*');
                if (error) throw error;
                allExpressions = data || [];
                showExpressionCategories();
            } catch (error) {
                console.error('Error:', error);
            }
        }

        function showExpressionCategories() {
            currentExprCategory = null;
            document.getElementById('expr-back-btn').classList.add('hidden');
            document.getElementById('expr-title').textContent = '–í–∏—Ä–∞–∑–∏';
            
            const categories = [...new Set(allExpressions.map(e => e.category))];
            const html = `<div class="grid grid-cols-2 gap-3">
                ${categories.map(cat => `
                    <button onclick="showExpressionList('${cat}')" class="bg-white rounded-xl p-4 text-left shadow-sm hover:shadow-md">
                        <div class="text-2xl mb-2">${categoryEmojis[cat] || 'üìù'}</div>
                        <h3 class="font-semibold text-gray-800 text-sm">${cat}</h3>
                        <p class="text-xs text-gray-500 mt-1">${allExpressions.filter(e => e.category === cat).length} –≤–∏—Ä–∞–∑—ñ–≤</p>
                    </button>
                `).join('')}
            </div>`;
            document.getElementById('expressions-content').innerHTML = html;
        }

        function showExpressionList(category) {
            currentExprCategory = category;
            document.getElementById('expr-back-btn').classList.remove('hidden');
            document.getElementById('expr-title').textContent = category;
            filterExpressions();
        }

        function filterExpressions() {
            if (!currentExprCategory) return;
            const search = document.getElementById('expr-search').value.toLowerCase();
            const filtered = allExpressions.filter(e => 
                e.category === currentExprCategory &&
                (e.dutch_expression.toLowerCase().includes(search) || 
                 e.ukrainian_translation.toLowerCase().includes(search))
            );
            
            const html = `<div class="space-y-3">
                ${filtered.map(exp => `
                    <div class="bg-white rounded-xl p-4 shadow-sm">
                        <div class="flex items-start justify-between">
                            <div class="flex-1">
                                <h3 class="font-semibold text-gray-800">${exp.dutch_expression}</h3>
                                <p class="text-gray-600 mt-1">${exp.ukrainian_translation}</p>
                                ${exp.meaning ? `<p class="text-sm text-gray-500 mt-2">${exp.meaning}</p>` : ''}
                            </div>
                            <button onclick="speak('${exp.dutch_expression.replace(/'/g, "\\'")}')" 
                                class="p-2 rounded-full bg-primary/10 text-primary hover:bg-primary/20 ml-2">
                                üîä
                            </button>
                        </div>
                        ${exp.example_nl ? `
                            <div class="mt-3 pt-3 border-t border-gray-100">
                                <p class="text-sm text-gray-700 italic">"${exp.example_nl}"</p>
                                <p class="text-sm text-gray-500">"${exp.example_ua}"</p>
                            </div>
                        ` : ''}
                    </div>
                `).join('')}
            </div>`;
            document.getElementById('expressions-content').innerHTML = html;
        }

        // Load phrasebook
        async function loadPhrases() {
            try {
                const { data, error } = await supabase.from('phrasebook').select('*').order('display_order');
                if (error) throw error;
                allPhrases = data || [];
                showPhrasebookCategories();
            } catch (error) {
                console.error('Error:', error);
            }
        }

        function showPhrasebookCategories() {
            currentPhraseCategory = null;
            document.getElementById('phrase-back-btn').classList.add('hidden');
            document.getElementById('phrase-title').textContent = '–†–æ–∑–º–æ–≤–Ω–∏–∫';
            
            const categories = [...new Set(allPhrases.map(p => p.category))];
            const html = `<div class="grid grid-cols-2 gap-3">
                ${categories.map(cat => `
                    <button onclick="showPhrasebookCategory('${cat}')" class="bg-white rounded-xl p-4 text-left shadow-sm hover:shadow-md">
                        <div class="text-2xl mb-2">${categoryEmojis[cat] || 'üìù'}</div>
                        <h3 class="font-semibold text-gray-800 text-sm">${cat}</h3>
                        <p class="text-xs text-gray-500 mt-1">${allPhrases.filter(p => p.category === cat).length} —Ñ—Ä–∞–∑</p>
                    </button>
                `).join('')}
            </div>`;
            document.getElementById('phrasebook-content').innerHTML = html;
        }

        function showPhrasebookCategory(category) {
            showTab('phrasebook');
            currentPhraseCategory = category;
            document.getElementById('phrase-back-btn').classList.remove('hidden');
            document.getElementById('phrase-title').textContent = category;
            filterPhrases();
        }

        function filterPhrases() {
            if (!currentPhraseCategory) return;
            const search = document.getElementById('phrase-search').value.toLowerCase();
            const filtered = allPhrases.filter(p => 
                p.category === currentPhraseCategory &&
                (p.ukrainian_phrase.toLowerCase().includes(search) || 
                 p.dutch_translation.toLowerCase().includes(search))
            );
            
            // Group by subcategory
            const grouped = {};
            filtered.forEach(p => {
                const sub = p.subcategory || '–ó–∞–≥–∞–ª—å–Ω–µ';
                if (!grouped[sub]) grouped[sub] = [];
                grouped[sub].push(p);
            });

            let html = '<div class="space-y-6">';
            for (const [subcategory, phrases] of Object.entries(grouped)) {
                html += `
                    <div>
                        <h2 class="text-sm font-semibold text-gray-500 mb-2 px-1">${subcategory}</h2>
                        <div class="space-y-3">
                            ${phrases.map(p => `
                                <div class="bg-white rounded-xl p-4 shadow-sm ${p.is_premium && !p.is_free_sample ? 'opacity-60' : ''}">
                                    <div class="flex items-start justify-between">
                                        <div class="flex-1">
                                            <div class="flex items-center gap-2">
                                                <p class="text-xs text-primary font-medium">üá∫üá¶ –£–ö–†–ê–á–ù–°–¨–ö–ê:</p>
                                                ${p.is_premium && !p.is_free_sample ? '<span class="text-gray-400">üîí</span>' : ''}
                                            </div>
                                            <h3 class="font-semibold text-gray-800 mt-1">${p.ukrainian_phrase}</h3>
                                            
                                            <p class="text-xs text-primary font-medium mt-3">üá≥üá± –ù–Ü–î–ï–†–õ–ê–ù–î–°–¨–ö–ê:</p>
                                            <p class="text-gray-700 mt-1">${p.dutch_translation}</p>
                                            
                                            ${p.context ? `<p class="text-sm text-gray-500 mt-3 pt-3 border-t border-gray-100">üí° ${p.context}</p>` : ''}
                                        </div>
                                        <button onclick="speak('${p.dutch_translation.replace(/'/g, "\\'")}')" 
                                            class="p-2 rounded-full bg-primary/10 text-primary hover:bg-primary/20 ml-2 flex-shrink-0">
                                            üîä
                                        </button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }
            html += '</div>';
            document.getElementById('phrasebook-content').innerHTML = html;
        }

        // Text-to-speech
        function speak(text) {
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'nl-NL';
            speechSynthesis.speak(utterance);
        }

        // Share app
        function shareApp() {
            if (navigator.share) {
                navigator.share({
                    title: '–®–≤–∏–¥–∫–∏–π —Ä–æ–∑–º–æ–≤–Ω–∏–∫ NL',
                    text: '–ö–æ—Ä–∏—Å–Ω–∏–π –¥–æ–¥–∞—Ç–æ–∫ –¥–ª—è —É–∫—Ä–∞—ó–Ω—Ü—ñ–≤ —É –ù—ñ–¥–µ—Ä–ª–∞–Ω–¥–∞—Ö! üá∫üá¶üá≥üá±',
                    url: window.location.href
                });
            } else {
                alert('–ü–æ—Å–∏–ª–∞–Ω–Ω—è: ' + window.location.href);
            }
        }

        // Initialize
        loadDailyExpression();
    </script>
</body>
</html>
